<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CLI: cli.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="dir_46f6ae84f50104985339032eb987b839.html">cpp</a>      </li>
      <li><a class="el" href="dir_8aeae964f4821b866509a437ddff25aa.html">src</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>cli.cpp</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">    Copyright (c) 2006-2010, Alexis Royer, http://alexis.royer.free.fr/CLI</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">    All rights reserved.</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">    Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">        * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00009"></a>00009 <span class="comment">        * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00010"></a>00010 <span class="comment">        * Neither the name of the CLI library project nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00013"></a>00013 <span class="comment">    &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00014"></a>00014 <span class="comment">    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00015"></a>00015 <span class="comment">    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR</span>
<a name="l00016"></a>00016 <span class="comment">    CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span>
<a name="l00017"></a>00017 <span class="comment">    EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
<a name="l00018"></a>00018 <span class="comment">    PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
<a name="l00019"></a>00019 <span class="comment">    PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
<a name="l00020"></a>00020 <span class="comment">    LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
<a name="l00021"></a>00021 <span class="comment">    NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<a name="l00022"></a>00022 <span class="comment">    SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00023"></a>00023 <span class="comment">*/</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="pch_8h.html" title="CLI library default pre-compiled header.">cli/pch.h</a>&quot;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#ifndef CLI_NO_REGEX</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">    #include &lt;regex.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">    #include &lt;string.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#endif</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="cli_8h.html" title="Cli class definition.">cli/cli.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="menu_8h.html" title="Menu and MenuRef classes definition.">cli/menu.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="shell_8h.html" title="Shell class definition.">cli/shell.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="keyword_8h.html" title="Keyword class definition.">cli/keyword.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="endl_8h.html" title="Endl class definition.">cli/endl.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="command__line_8h.html" title="CommandLine class definition.">cli/command_line.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="traces_8h.html" title="Traces management system definition.">cli/traces.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="assert_8h.html" title="Assertion facilities.">cli/assert.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="config__menu_8h.html" title="ConfigMenu class definition.">config_menu.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="traces__menu_8h.html" title="Traces menu definition.">traces_menu.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="consistency_8h.html" title="Object consistency insurance.">consistency.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="constraints_8h.html" title="Object consistency insurance.">constraints.h</a>&quot;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <a class="code" href="namespace_8h.html#a965caf70ca576c007bee150001248651" title="Using namespace directive.">CLI_NS_USE</a>(cli)
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="preprocessor">#define TRACE_CLI GetCliTraceClass()</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span>
<a name="l00052"></a>00052 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classTraceClass.html" title="Trace class object.">TraceClass</a>&amp; GetCliTraceClass(<span class="keywordtype">void</span>)
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054     <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classTraceClass.html" title="Trace class object.">TraceClass</a> cli_CliTraceClass(<span class="stringliteral">&quot;CLI&quot;</span>, <a class="code" href="classHelp.html" title="Help container class.">Help</a>()
<a name="l00055"></a>00055         .AddHelp(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">Help::LANG_EN</a>, <span class="stringliteral">&quot;CLI traces&quot;</span>)
<a name="l00056"></a>00056         .AddHelp(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">Help::LANG_FR</a>, <span class="stringliteral">&quot;Traces de CLI&quot;</span>));
<a name="l00057"></a>00057     <span class="keywordflow">return</span> cli_CliTraceClass;
<a name="l00058"></a>00058 }
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 
<a name="l00062"></a>00062 <span class="keyword">static</span> <a class="code" href="classCli.html#af9107780634f75f44dee35227cad19eb" title="CLI list type.">Cli::List</a>&amp; GetCliRegistry(<span class="keywordtype">void</span>)
<a name="l00063"></a>00063 {
<a name="l00064"></a>00064     <span class="keyword">static</span> <a class="code" href="classCli.html#af9107780634f75f44dee35227cad19eb" title="CLI list type.">Cli::List</a> cli_CliRegistry(MAX_CLI_REGISTRY_COUNT);
<a name="l00065"></a>00065     <span class="keywordflow">return</span> cli_CliRegistry;
<a name="l00066"></a>00066 }
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 Cli::Cli(<span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> STR_Name, <span class="keyword">const</span> <a class="code" href="classHelp.html" title="Help container class.">Help</a>&amp; CLI_Help)
<a name="l00070"></a>00070   : <a class="code" href="classMenu.html" title="Menu definition.">Menu</a>(STR_Name, CLI_Help),
<a name="l00071"></a>00071     m_pcliShell(NULL),
<a name="l00072"></a>00072     m_qMenus(MAX_MENU_PER_CLI),
<a name="l00073"></a>00073     m_pcliConfigMenu(NULL), m_pcliConfigMenuNode(NULL)
<a name="l00074"></a>00074     #ifdef <a class="code" href="preprocessing_8h.html#a152fc5203b90b1cff03b7b78579b8f52" title="Debug preprocessing constant.">_DEBUG</a>
<a name="l00075"></a>00075     , m_pcliTracesMenu(NULL), m_pcliTracesMenuNode(NULL)
<a name="l00076"></a>00076     #endif
<a name="l00077"></a>00077 {
<a name="l00078"></a>00078     <a class="code" href="consistency_8h.html#acd519988d0498954c9a9507773b172b7" title="Ensures common input / output devices creation.">EnsureCommonDevices</a>();
<a name="l00079"></a>00079     <a class="code" href="consistency_8h.html#aed1a89fb454edbbeb912461221e72014" title="Ensures the trace object creation.">EnsureTraces</a>();
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     <span class="comment">// Set the CLI reference to oneself.</span>
<a name="l00082"></a>00082     SetCli(*<span class="keyword">this</span>);
<a name="l00083"></a>00083 
<a name="l00084"></a>00084     <span class="comment">// Register this new CLI in the global CLI list.</span>
<a name="l00085"></a>00085     <span class="keywordflow">if</span> (GetCliRegistry().AddTail(<span class="keyword">this</span>))
<a name="l00086"></a>00086     {
<a name="l00087"></a>00087         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(TRACE_CLI) &lt;&lt; <span class="stringliteral">&quot;New CLI &#39;&quot;</span> &lt;&lt; GetName() &lt;&lt; <span class="stringliteral">&quot;&#39;.&quot;</span> &lt;&lt; cli::endl;
<a name="l00088"></a>00088     }
<a name="l00089"></a>00089     <span class="keywordflow">else</span>
<a name="l00090"></a>00090     {
<a name="l00091"></a>00091         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(TRACE_CLI) &lt;&lt; <span class="stringliteral">&quot;Error: New CLI &#39;&quot;</span> &lt;&lt; GetName() &lt;&lt; <span class="stringliteral">&quot;&#39; could not be registered.&quot;</span> &lt;&lt; cli::endl;
<a name="l00092"></a>00092     }
<a name="l00093"></a>00093 }
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <a class="code" href="classCli.html#a3be4b8d07e68bab3f7209bc700b3e695" title="Destructor.">Cli::~Cli</a>(<span class="keywordtype">void</span>)
<a name="l00096"></a>00096 {
<a name="l00097"></a>00097     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(TRACE_CLI) &lt;&lt; <span class="stringliteral">&quot;Deletion of CLI &#39;&quot;</span> &lt;&lt; <a class="code" href="classMenu.html#a37410d39de4348eee3c811af1a3774cd" title="Menu name access.">GetName</a>() &lt;&lt; <span class="stringliteral">&quot;&#39;.&quot;</span> &lt;&lt; cli::endl;
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     <span class="comment">// Remove this CLI from the global CLI list.</span>
<a name="l00100"></a>00100     <span class="keywordflow">for</span> (   Cli::List::Iterator it = GetCliRegistry().GetIterator();
<a name="l00101"></a>00101             GetCliRegistry().IsValid(it);
<a name="l00102"></a>00102             GetCliRegistry().MoveNext(it))
<a name="l00103"></a>00103     {
<a name="l00104"></a>00104         <span class="keywordflow">if</span> (GetCliRegistry().GetAt(it) == <span class="keyword">this</span>)
<a name="l00105"></a>00105         {
<a name="l00106"></a>00106             GetCliRegistry().Remove(it);
<a name="l00107"></a>00107             <span class="keywordflow">break</span>;
<a name="l00108"></a>00108         }
<a name="l00109"></a>00109     }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     <span class="comment">// Destroy menus.</span>
<a name="l00112"></a>00112     <span class="keywordflow">while</span> (! m_qMenus.IsEmpty())
<a name="l00113"></a>00113     {
<a name="l00114"></a>00114         <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classMenu.html" title="Menu definition.">Menu</a>* <span class="keyword">const</span> pcli_Menu = m_qMenus.RemoveTail())
<a name="l00115"></a>00115         {
<a name="l00116"></a>00116             <span class="keyword">delete</span> pcli_Menu;
<a name="l00117"></a>00117         }
<a name="l00118"></a>00118     }
<a name="l00119"></a>00119 }
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classCli.html#a7777d3ea1f2269fad471b830d493084e" title="Retrieve CLI references from their names.">Cli::FindFromName</a>(<a class="code" href="classCli.html#af9107780634f75f44dee35227cad19eb" title="CLI list type.">Cli::List</a>&amp; CLI_CliList, <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> STR_RegExp)
<a name="l00122"></a>00122 {
<a name="l00123"></a>00123 <span class="preprocessor">#ifndef CLI_NO_REGEX</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>    <span class="comment">// Compile the regular expression.</span>
<a name="l00125"></a>00125     regex_t s_RegExp;
<a name="l00126"></a>00126     memset(&amp; s_RegExp, <span class="charliteral">&#39;\0&#39;</span>, <span class="keyword">sizeof</span>(regex_t));
<a name="l00127"></a>00127     <span class="keywordflow">if</span> (regcomp(&amp; s_RegExp, STR_RegExp, 0) != 0)
<a name="l00128"></a>00128     {
<a name="l00129"></a>00129         <span class="keywordflow">return</span> -1;
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131 <span class="preprocessor">#endif</span>
<a name="l00132"></a>00132 <span class="preprocessor"></span>
<a name="l00133"></a>00133     <span class="comment">// Check the name for each CLI instance.</span>
<a name="l00134"></a>00134     <span class="keyword">const</span> <span class="keywordtype">int</span> i_InitialCount = CLI_CliList.GetCount();
<a name="l00135"></a>00135     <span class="keywordflow">for</span> (   Cli::List::Iterator it = GetCliRegistry().GetIterator();
<a name="l00136"></a>00136             GetCliRegistry().IsValid(it);
<a name="l00137"></a>00137             GetCliRegistry().MoveNext(it))
<a name="l00138"></a>00138     {
<a name="l00139"></a>00139         <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classCli.html" title="CLI definition class.">Cli</a>* <span class="keyword">const</span> pcli_Cli = GetCliRegistry().GetAt(it))
<a name="l00140"></a>00140         {
<a name="l00141"></a>00141 <span class="preprocessor">#ifndef CLI_NO_REGEX</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (regexec(&amp; s_RegExp, pcli_Cli-&gt;GetName(), 0, NULL, 0) == 0)
<a name="l00143"></a>00143 <span class="preprocessor">#endif</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span>            {
<a name="l00145"></a>00145                 <span class="keywordflow">if</span> (! CLI_CliList.AddTail(pcli_Cli))
<a name="l00146"></a>00146                 {
<a name="l00147"></a>00147                     <a class="code" href="assert_8h.html#a1fe8f84b5d89ceccc07361b1d0da0144" title="CLI assertion macro.">CLI_ASSERT</a>(<span class="keyword">false</span>);
<a name="l00148"></a>00148                 }
<a name="l00149"></a>00149             }
<a name="l00150"></a>00150         }
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 <span class="preprocessor">#ifndef CLI_NO_REGEX</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span>    <span class="comment">// Free.</span>
<a name="l00155"></a>00155     regfree(&amp; s_RegExp);
<a name="l00156"></a>00156 <span class="preprocessor">#endif</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span>
<a name="l00158"></a>00158     <span class="keywordflow">return</span> ((<span class="keywordtype">int</span>) CLI_CliList.GetCount() - i_InitialCount);
<a name="l00159"></a>00159 }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 <a class="code" href="classMenu.html" title="Menu definition.">Menu</a>&amp; <a class="code" href="classCli.html#aa9b67aca58b34f57a8f50c48c1baa9a1" title="Menu addition.">Cli::AddMenu</a>(<a class="code" href="classMenu.html" title="Menu definition.">Menu</a>* <span class="keyword">const</span> PCLI_Menu)
<a name="l00162"></a>00162 {
<a name="l00163"></a>00163     <span class="keywordflow">if</span> (PCLI_Menu != NULL)
<a name="l00164"></a>00164     {
<a name="l00165"></a>00165         PCLI_Menu-&gt;<a class="code" href="classMenu.html#a29937051de2dbf23a0242e95d239556a" title="CLI reference setting.">SetCli</a>(*<span class="keyword">this</span>);
<a name="l00166"></a>00166         <span class="keywordflow">if</span> (! m_qMenus.AddTail(PCLI_Menu))
<a name="l00167"></a>00167         {
<a name="l00168"></a>00168             <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="traces_8h.html#a243b1b1f8ca7e7e98ac73a2d115256f4" title="Internal error common trace class singleton redirection.">INTERNAL_ERROR</a>)
<a name="l00169"></a>00169                 &lt;&lt; <span class="stringliteral">&quot;Could not add &#39;&quot;</span> &lt;&lt; PCLI_Menu-&gt;<a class="code" href="classElement.html#a6d9e2ee49e3a8b9306761f52a456830a" title="Access to the string identifier.">GetKeyword</a>() &lt;&lt; <span class="stringliteral">&quot;&#39; &quot;</span>
<a name="l00170"></a>00170                 &lt;&lt; <span class="stringliteral">&quot;to CLI &#39;&quot;</span> &lt;&lt; <a class="code" href="classMenu.html#a37410d39de4348eee3c811af1a3774cd" title="Menu name access.">GetName</a>() &lt;&lt; <span class="stringliteral">&quot;&#39;.&quot;</span> &lt;&lt; cli::endl;
<a name="l00171"></a>00171         }
<a name="l00172"></a>00172     }
<a name="l00173"></a>00173     <a class="code" href="assert_8h.html#a1fe8f84b5d89ceccc07361b1d0da0144" title="CLI assertion macro.">CLI_ASSERT</a>(PCLI_Menu != NULL);
<a name="l00174"></a>00174     <span class="keywordflow">return</span> *PCLI_Menu;
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 <span class="keyword">const</span> <a class="code" href="classMenu.html" title="Menu definition.">Menu</a>* <span class="keyword">const</span> <a class="code" href="classCli.html#a6d7b583f795e38b487c7cb33e6fc6663" title="Menu retrieval.">Cli::GetMenu</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> STR_MenuName)<span class="keyword"> const</span>
<a name="l00178"></a>00178 <span class="keyword"></span>{
<a name="l00179"></a>00179     <span class="comment">// First of all, look in the menu list</span>
<a name="l00180"></a>00180     <span class="keywordflow">for</span> (   tk::Queue&lt;const Menu*&gt;::Iterator it = m_qMenus.GetIterator();
<a name="l00181"></a>00181             m_qMenus.IsValid(it);
<a name="l00182"></a>00182             m_qMenus.MoveNext(it))
<a name="l00183"></a>00183     {
<a name="l00184"></a>00184         <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classMenu.html" title="Menu definition.">Menu</a>* <span class="keyword">const</span> pcli_Menu = m_qMenus.GetAt(it))
<a name="l00185"></a>00185         {
<a name="l00186"></a>00186             <span class="keywordflow">if</span> (pcli_Menu-&gt;GetName() == STR_MenuName)
<a name="l00187"></a>00187             {
<a name="l00188"></a>00188                 <span class="keywordflow">return</span> pcli_Menu;
<a name="l00189"></a>00189             }
<a name="l00190"></a>00190         }
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <span class="comment">// Possibly look for the CLI itself.</span>
<a name="l00194"></a>00194     <span class="keywordflow">if</span> (<a class="code" href="classMenu.html#a37410d39de4348eee3c811af1a3774cd" title="Menu name access.">GetName</a>() == STR_MenuName)
<a name="l00195"></a>00195     {
<a name="l00196"></a>00196         <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00197"></a>00197     }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     <span class="keywordflow">return</span> NULL;
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 <span class="keywordtype">void</span> <a class="code" href="classCli.html#ab963f556d49091d08f1a8ca10186e06f" title="Set the shell reference when executing.">Cli::SetShell</a>(<a class="code" href="classShell.html" title="Shell management.">Shell</a>&amp; CLI_Shell)<span class="keyword"> const</span>
<a name="l00203"></a>00203 <span class="keyword"></span>{
<a name="l00204"></a>00204     m_pcliShell = &amp; CLI_Shell;
<a name="l00205"></a>00205 }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 <a class="code" href="classShell.html" title="Shell management.">Shell</a>&amp; <a class="code" href="classCli.html#af8cba9ff833ad2026f69e5a9e1a9e258" title="Returns the shell reference on execution.">Cli::GetShell</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00208"></a>00208 <span class="keyword"></span>{
<a name="l00209"></a>00209     <span class="keywordflow">if</span> (m_pcliShell != NULL)
<a name="l00210"></a>00210     {
<a name="l00211"></a>00211         <span class="keywordflow">return</span> *m_pcliShell;
<a name="l00212"></a>00212     }
<a name="l00213"></a>00213     <span class="keywordflow">else</span>
<a name="l00214"></a>00214     {
<a name="l00215"></a>00215         <span class="keyword">static</span> <a class="code" href="classShell.html" title="Shell management.">Shell</a> cli_Shell(*<span class="keyword">this</span>);
<a name="l00216"></a>00216         <span class="keywordflow">return</span> cli_Shell;
<a name="l00217"></a>00217     }
<a name="l00218"></a>00218 }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <a class="code" href="classConfigMenu.html" title="CLI configuration menu definition.">ConfigMenu</a>&amp; Cli::GetConfigMenu(<span class="keywordtype">void</span>)
<a name="l00221"></a>00221 {
<a name="l00222"></a>00222     <a class="code" href="assert_8h.html#a1fe8f84b5d89ceccc07361b1d0da0144" title="CLI assertion macro.">CLI_ASSERT</a>(m_pcliConfigMenu != NULL);
<a name="l00223"></a>00223     <span class="keywordflow">return</span> *m_pcliConfigMenu;
<a name="l00224"></a>00224 }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="keyword">const</span> <a class="code" href="classConfigMenu.html" title="CLI configuration menu definition.">ConfigMenu</a>&amp; Cli::GetConfigMenu(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00227"></a>00227 <span class="keyword"></span>{
<a name="l00228"></a>00228     <a class="code" href="assert_8h.html#a1fe8f84b5d89ceccc07361b1d0da0144" title="CLI assertion macro.">CLI_ASSERT</a>(m_pcliConfigMenu != NULL);
<a name="l00229"></a>00229     <span class="keywordflow">return</span> *m_pcliConfigMenu;
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 <span class="keyword">const</span> <a class="code" href="classKeyword.html" title="Keyword element class.">Keyword</a>&amp; Cli::GetConfigMenuNode(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00233"></a>00233 <span class="keyword"></span>{
<a name="l00234"></a>00234     <a class="code" href="assert_8h.html#a1fe8f84b5d89ceccc07361b1d0da0144" title="CLI assertion macro.">CLI_ASSERT</a>(m_pcliConfigMenuNode != NULL);
<a name="l00235"></a>00235     <span class="keywordflow">return</span> *m_pcliConfigMenuNode;
<a name="l00236"></a>00236 }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classCli.html#afcef4a4232b6a21d8a6262adb51b8b49" title="Configuration menu enabling.">Cli::EnableConfigMenu</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span> B_Enable)
<a name="l00239"></a>00239 {
<a name="l00240"></a>00240     <span class="keywordtype">bool</span> b_Res;
<a name="l00241"></a>00241     <a class="code" href="assert_8h.html#a1fe8f84b5d89ceccc07361b1d0da0144" title="CLI assertion macro.">CLI_ASSERT</a>(m_pcliConfigMenuNode != NULL);
<a name="l00242"></a>00242     <span class="keywordflow">if</span> (B_Enable)
<a name="l00243"></a>00243     {
<a name="l00244"></a>00244         <a class="code" href="classSyntaxNode.html#a169e1a8e830664609bcf4012ecdea760" title="Possible element addition.">AddElement</a>(m_pcliConfigMenuNode);
<a name="l00245"></a>00245         b_Res = <span class="keyword">true</span>;
<a name="l00246"></a>00246     }
<a name="l00247"></a>00247     <span class="keywordflow">else</span>
<a name="l00248"></a>00248     {
<a name="l00249"></a>00249         b_Res = <a class="code" href="classSyntaxNode.html#ae85a0282cf5fa79e45d80c9f26883d9f" title="Element removal.">RemoveElement</a>(m_pcliConfigMenuNode, <span class="keyword">false</span>);
<a name="l00250"></a>00250     }
<a name="l00251"></a>00251     <span class="keywordflow">return</span> b_Res;
<a name="l00252"></a>00252 }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254 <span class="preprocessor">#ifdef _DEBUG</span>
<a name="l00255"></a>00255 <span class="preprocessor"></span><a class="code" href="classTracesMenu.html" title="Traces menu definition.">TracesMenu</a>&amp; Cli::GetTracesMenu(<span class="keywordtype">void</span>)
<a name="l00256"></a>00256 {
<a name="l00257"></a>00257     <a class="code" href="assert_8h.html#a1fe8f84b5d89ceccc07361b1d0da0144" title="CLI assertion macro.">CLI_ASSERT</a>(m_pcliTracesMenu != NULL);
<a name="l00258"></a>00258     <span class="keywordflow">return</span> *m_pcliTracesMenu;
<a name="l00259"></a>00259 }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 <span class="keyword">const</span> <a class="code" href="classTracesMenu.html" title="Traces menu definition.">TracesMenu</a>&amp; Cli::GetTracesMenu(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00262"></a>00262 <span class="keyword"></span>{
<a name="l00263"></a>00263     <a class="code" href="assert_8h.html#a1fe8f84b5d89ceccc07361b1d0da0144" title="CLI assertion macro.">CLI_ASSERT</a>(m_pcliTracesMenu != NULL);
<a name="l00264"></a>00264     <span class="keywordflow">return</span> *m_pcliTracesMenu;
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 <span class="keyword">const</span> <a class="code" href="classKeyword.html" title="Keyword element class.">Keyword</a>&amp; Cli::GetTracesMenuNode(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00268"></a>00268 <span class="keyword"></span>{
<a name="l00269"></a>00269     <a class="code" href="assert_8h.html#a1fe8f84b5d89ceccc07361b1d0da0144" title="CLI assertion macro.">CLI_ASSERT</a>(m_pcliTracesMenuNode != NULL);
<a name="l00270"></a>00270     <span class="keywordflow">return</span> *m_pcliTracesMenuNode;
<a name="l00271"></a>00271 }
<a name="l00272"></a>00272 <span class="preprocessor">#endif</span>
<a name="l00273"></a>00273 <span class="preprocessor"></span>
<a name="l00274"></a>00274 <span class="keywordtype">void</span> <a class="code" href="classCli.html#a1a8c44cdeaae941d2a472845a61ee5e6" title="CLI reference setting.">Cli::SetCli</a>(<a class="code" href="classCli.html" title="CLI definition class.">Cli</a>&amp; CLI_Cli)
<a name="l00275"></a>00275 {
<a name="l00276"></a>00276     <a class="code" href="classCli.html#a1a8c44cdeaae941d2a472845a61ee5e6" title="CLI reference setting.">Menu::SetCli</a>(CLI_Cli);
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     m_pcliConfigMenu = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classConfigMenu.html" title="CLI configuration menu definition.">ConfigMenu</a>*<span class="keyword">&gt;</span>(&amp; <a class="code" href="classCli.html#aa9b67aca58b34f57a8f50c48c1baa9a1" title="Menu addition.">AddMenu</a>(<span class="keyword">new</span> <a class="code" href="classConfigMenu.html" title="CLI configuration menu definition.">ConfigMenu</a>()));
<a name="l00279"></a>00279     {   <a class="code" href="classHelp.html" title="Help container class.">Help</a> cli_Help(<a class="code" href="classHelp.html" title="Help container class.">Help</a>()
<a name="l00280"></a>00280             .AddHelp(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">Help::LANG_EN</a>, <span class="stringliteral">&quot;CLI configuration menu&quot;</span>)
<a name="l00281"></a>00281             .AddHelp(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">Help::LANG_FR</a>, <span class="stringliteral">&quot;Menu de configuration du CLI&quot;</span>));
<a name="l00282"></a>00282         m_pcliConfigMenuNode = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classKeyword.html" title="Keyword element class.">Keyword</a>*<span class="keyword">&gt;</span>(&amp; <a class="code" href="classSyntaxNode.html#a169e1a8e830664609bcf4012ecdea760" title="Possible element addition.">AddElement</a>(<span class="keyword">new</span> <a class="code" href="classKeyword.html" title="Keyword element class.">Keyword</a>(<span class="stringliteral">&quot;cli-config&quot;</span>, cli_Help)));
<a name="l00283"></a>00283         <a class="code" href="classEndl.html" title="End of command line element.">Endl</a>* <span class="keyword">const</span> pcli_Endl = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classEndl.html" title="End of command line element.">Endl</a>*<span class="keyword">&gt;</span>(&amp; m_pcliConfigMenuNode-&gt;<a class="code" href="classSyntaxNode.html#a169e1a8e830664609bcf4012ecdea760" title="Possible element addition.">AddElement</a>(<span class="keyword">new</span> <a class="code" href="classEndl.html" title="End of command line element.">Endl</a>(cli_Help)));
<a name="l00284"></a>00284         pcli_Endl-&gt;<a class="code" href="classEndl.html#adec624bc985c15f12972d4d4e6cd310f" title="Attaches the optional menu.">SetMenuRef</a>(<span class="keyword">new</span> <a class="code" href="classMenuRef.html" title="Menu reference element.">MenuRef</a>(*m_pcliConfigMenu)); }
<a name="l00285"></a>00285 <span class="preprocessor">    #ifdef _DEBUG</span>
<a name="l00286"></a>00286 <span class="preprocessor"></span>    m_pcliTracesMenu = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classTracesMenu.html" title="Traces menu definition.">TracesMenu</a>*<span class="keyword">&gt;</span>(&amp; <a class="code" href="classCli.html#aa9b67aca58b34f57a8f50c48c1baa9a1" title="Menu addition.">AddMenu</a>(<span class="keyword">new</span> <a class="code" href="classTracesMenu.html" title="Traces menu definition.">TracesMenu</a>()));
<a name="l00287"></a>00287     {   <a class="code" href="classHelp.html" title="Help container class.">Help</a> cli_Help(<a class="code" href="classHelp.html" title="Help container class.">Help</a>()
<a name="l00288"></a>00288             .AddHelp(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">Help::LANG_EN</a>, <span class="stringliteral">&quot;Traces menu&quot;</span>)
<a name="l00289"></a>00289             .AddHelp(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">Help::LANG_FR</a>, <span class="stringliteral">&quot;Menu de configuration de traces&quot;</span>));
<a name="l00290"></a>00290         m_pcliTracesMenuNode = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classKeyword.html" title="Keyword element class.">Keyword</a>*<span class="keyword">&gt;</span>(&amp; <a class="code" href="classSyntaxNode.html#a169e1a8e830664609bcf4012ecdea760" title="Possible element addition.">AddElement</a>(<span class="keyword">new</span> <a class="code" href="classKeyword.html" title="Keyword element class.">Keyword</a>(<span class="stringliteral">&quot;traces&quot;</span>, cli_Help)));
<a name="l00291"></a>00291         <a class="code" href="classEndl.html" title="End of command line element.">Endl</a>* <span class="keyword">const</span> pcli_Endl = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classEndl.html" title="End of command line element.">Endl</a>*<span class="keyword">&gt;</span>(&amp; m_pcliTracesMenuNode-&gt;AddElement(<span class="keyword">new</span> <a class="code" href="classEndl.html" title="End of command line element.">Endl</a>(cli_Help)));
<a name="l00292"></a>00292         pcli_Endl-&gt;<a class="code" href="classEndl.html#adec624bc985c15f12972d4d4e6cd310f" title="Attaches the optional menu.">SetMenuRef</a>(<span class="keyword">new</span> <a class="code" href="classMenuRef.html" title="Menu reference element.">MenuRef</a>(*m_pcliTracesMenu)); }
<a name="l00293"></a>00293 <span class="preprocessor">    #endif</span>
<a name="l00294"></a>00294 <span class="preprocessor"></span>}
<a name="l00295"></a>00295 
<a name="l00296"></a>00296 <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classCli.html#a561c566128a83373f5c694da3db5eeb6" title="Reserved commands execution.">Cli::ExecuteReserved</a>(<span class="keyword">const</span> <a class="code" href="classCommandLine.html" title="Command line parsing.">CommandLine</a>&amp; CLI_CommandLine)<span class="keyword"> const</span>
<a name="l00297"></a>00297 <span class="keyword"></span>{
<a name="l00298"></a>00298     <a class="code" href="classCommandLineIterator.html" title="Command line iteration.">CommandLineIterator</a> it(CLI_CommandLine);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="keywordflow">if</span> (! it.StepIt()) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
<a name="l00301"></a>00301     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (it == GetConfigMenuNode())
<a name="l00302"></a>00302     {
<a name="l00303"></a>00303         <span class="keywordflow">if</span> (! it.StepIt()) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
<a name="l00304"></a>00304         <span class="keywordflow">if</span> (dynamic_cast&lt;const Endl*&gt;(*it))
<a name="l00305"></a>00305         {
<a name="l00306"></a>00306             <span class="comment">// Do nothing but return true so that an execution error is not detected.</span>
<a name="l00307"></a>00307             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00308"></a>00308         }
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310 <span class="preprocessor">    #ifdef _DEBUG</span>
<a name="l00311"></a>00311 <span class="preprocessor"></span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (it == GetTracesMenuNode())
<a name="l00312"></a>00312     {
<a name="l00313"></a>00313         <span class="keywordflow">if</span> (! it.StepIt()) { <span class="keywordflow">return</span> <span class="keyword">false</span>; }
<a name="l00314"></a>00314         <span class="keywordflow">if</span> (dynamic_cast&lt;const Endl*&gt;(*it))
<a name="l00315"></a>00315         {
<a name="l00316"></a>00316             <span class="comment">// Do nothing but return true so that an execution error is not detected.</span>
<a name="l00317"></a>00317             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00318"></a>00318         }
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320 <span class="preprocessor">    #endif</span>
<a name="l00321"></a>00321 <span class="preprocessor"></span>
<a name="l00322"></a>00322     <span class="keywordflow">return</span> <a class="code" href="classCli.html#a561c566128a83373f5c694da3db5eeb6" title="Reserved commands execution.">Menu::ExecuteReserved</a>(CLI_CommandLine);
<a name="l00323"></a>00323 }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325 <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classCli.html#a687c16dd233ad0be562a3c2bc3982fdf" title="Handler on error.">Cli::OnError</a>(<span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>&amp; CLI_Location, <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>&amp; CLI_ErrorMessage)<span class="keyword"> const</span>
<a name="l00326"></a>00326 <span class="keyword"></span>{
<a name="l00327"></a>00327     <span class="comment">// Default return is true, in order to have the shell display the error.</span>
<a name="l00328"></a>00328     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00329"></a>00329 }
<a name="l00330"></a>00330 
<a name="l00331"></a>00331 <span class="keywordtype">void</span> <a class="code" href="classCli.html#a775913806833ee44f814a317d17e9a3d" title="Handler on menu exit.">Cli::OnExit</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00332"></a>00332 <span class="keyword"></span>{
<a name="l00333"></a>00333 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Dec 29 2010 04:19:00 for CLI by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
