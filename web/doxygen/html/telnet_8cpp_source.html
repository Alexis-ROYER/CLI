<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>CLI: telnet.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_6899de2c58f35e315884cd7c843d840e.html">cpp</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_7c10fd4cf4e41bef243f8fa9d80dcdba.html">src</a>
  </div>
</div>
<div class="contents">
<h1>telnet.cpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">    Copyright (c) 2006-2009, Alexis Royer</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">    All rights reserved.</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">    Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">        * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00009"></a>00009 <span class="comment">        * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00010"></a>00010 <span class="comment">        * Neither the name of the CLI library project nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00013"></a>00013 <span class="comment">    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00014"></a>00014 <span class="comment">    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00015"></a>00015 <span class="comment">    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR</span>
<a name="l00016"></a>00016 <span class="comment">    CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span>
<a name="l00017"></a>00017 <span class="comment">    EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
<a name="l00018"></a>00018 <span class="comment">    PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
<a name="l00019"></a>00019 <span class="comment">    PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
<a name="l00020"></a>00020 <span class="comment">    LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
<a name="l00021"></a>00021 <span class="comment">    NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<a name="l00022"></a>00022 <span class="comment">    SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00023"></a>00023 <span class="comment">*/</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="pch_8h.html" title="CLI library default pre-compiled header.">cli/pch.h</a>"</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#ifndef CLI_WIN_NETWORK</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">    #include &lt;sys/types.h&gt;</span> <span class="comment">// socket, bind, listen</span>
<a name="l00030"></a>00030 <span class="preprocessor">    #include &lt;sys/socket.h&gt;</span> <span class="comment">// socket, bind, listen</span>
<a name="l00031"></a>00031 <span class="preprocessor">    #include &lt;netinet/in.h&gt;</span> <span class="comment">// sockaddr_in</span>
<a name="l00032"></a>00032 <span class="preprocessor">    #include &lt;unistd.h&gt;</span> <span class="comment">// getpid</span>
<a name="l00033"></a>00033 <span class="preprocessor">#else</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">    #include &lt;winsock2.h&gt;</span> <span class="comment">// Windows sockets</span>
<a name="l00035"></a>00035 <span class="preprocessor">    #define close closesocket</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>    <span class="comment">// Disable disturbing macros.</span>
<a name="l00037"></a>00037 <span class="preprocessor">    #undef DELETE</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdio.h&gt;</span> <span class="comment">// close</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="preprocessor">#include "<a class="code" href="telnet_8h.html" title="TelnetServer and TelnetConnection classes definition.">cli/telnet.h</a>"</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include "<a class="code" href="shell_8h.html" title="Shell class definition.">cli/shell.h</a>"</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include "<a class="code" href="traces_8h.html" title="Traces management system definition.">cli/traces.h</a>"</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <a class="code" href="namespace_8h.html#965caf70ca576c007bee150001248651" title="Using namespace directive.">CLI_NS_USE</a>(cli)
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="preprocessor">#ifndef CLI_TELNET_INPUT_BUFFER_SIZE</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span><span class="preprocessor">    #define CLI_TELNET_INPUT_BUFFER_SIZE 1024</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span>
<a name="l00055"></a>00055 <span class="preprocessor">#define CLI_TELNET_IN GetTelnetInTraceClass()</span>
<a name="l00057"></a>00057 <span class="preprocessor">static const TraceClass&amp; GetTelnetInTraceClass(void)</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span>{
<a name="l00059"></a>00059     <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classTraceClass.html" title="Trace class object.">TraceClass</a> cli_TelnetInTraceClass(<span class="stringliteral">"CLI_TELNET_IN"</span>, <a class="code" href="classHelp.html" title="Help container class.">Help</a>()
<a name="l00060"></a>00060         .AddHelp(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df" title="English.">Help::LANG_EN</a>, <span class="stringliteral">"CLI telnet connection input traces"</span>)
<a name="l00061"></a>00061         .AddHelp(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f" title="French.">Help::LANG_FR</a>, <span class="stringliteral">"Traces d'entrées d'une connexion telnet CLI"</span>));
<a name="l00062"></a>00062     <span class="keywordflow">return</span> cli_TelnetInTraceClass;
<a name="l00063"></a>00063 }
<a name="l00065"></a>00065 <span class="preprocessor">#define CLI_TELNET_OUT GetTelnetOutTraceClass()</span>
<a name="l00067"></a>00067 <span class="preprocessor">static const TraceClass&amp; GetTelnetOutTraceClass(void)</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span>{
<a name="l00069"></a>00069     <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classTraceClass.html" title="Trace class object.">TraceClass</a> cli_TelnetOutTraceClass(<span class="stringliteral">"CLI_TELNET_OUT"</span>, <a class="code" href="classHelp.html" title="Help container class.">Help</a>()
<a name="l00070"></a>00070         .AddHelp(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df" title="English.">Help::LANG_EN</a>, <span class="stringliteral">"CLI telnet connection output traces"</span>)
<a name="l00071"></a>00071         .AddHelp(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f" title="French.">Help::LANG_FR</a>, <span class="stringliteral">"Traces de sorties d'une connexion telnet CLI"</span>));
<a name="l00072"></a>00072     <span class="keywordflow">return</span> cli_TelnetOutTraceClass;
<a name="l00073"></a>00073 }
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 TelnetServer::TelnetServer(<a class="code" href="classShell.html" title="Shell management.">Shell</a>&amp; CLI_Shell, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> UL_TcpPort)
<a name="l00078"></a>00078   : m_cliShell(CLI_Shell),
<a name="l00079"></a>00079     m_ulTcpPort(UL_TcpPort)
<a name="l00080"></a>00080 {
<a name="l00081"></a>00081     <span class="comment">// Does nothing but registers the appropriate trace classes.</span>
<a name="l00082"></a>00082     <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN);
<a name="l00083"></a>00083     <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_OUT);
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <a class="code" href="classTelnetServer.html#ce9f6cf047ae8a1e427ca7ca5dcbce12" title="Destructor.">TelnetServer::~TelnetServer</a>(<span class="keywordtype">void</span>)
<a name="l00087"></a>00087 {
<a name="l00088"></a>00088 }
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="keywordtype">void</span> <a class="code" href="classTelnetServer.html#97520ee0f8761c9827cb13addc8ffd68" title="Starts the server.">TelnetServer::StartServer</a>(<span class="keywordtype">void</span>)
<a name="l00091"></a>00091 {
<a name="l00092"></a>00092     <span class="keyword">const</span> <span class="keywordtype">int</span> i_ServerSocket = socket(AF_INET, SOCK_STREAM, 0);
<a name="l00093"></a>00093 <span class="preprocessor">    #ifdef CLI_WIN_NETWORK</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>    <span class="comment">// Winsock needs to be initialized.</span>
<a name="l00095"></a>00095     <span class="keywordflow">if</span> (i_ServerSocket &lt; 0)
<a name="l00096"></a>00096     {
<a name="l00097"></a>00097         WORD wVersionRequested = MAKEWORD(2, 2);
<a name="l00098"></a>00098         WSADATA wsaData;
<a name="l00099"></a>00099         <span class="keywordtype">int</span> err = WSAStartup(wVersionRequested, &amp; wsaData);
<a name="l00100"></a>00100         <span class="keywordflow">if</span> (err == 0)
<a name="l00101"></a>00101         {
<a name="l00102"></a>00102             ((<span class="keywordtype">int</span>&amp;) i_ServerSocket) = socket(AF_INET, SOCK_STREAM, 0);
<a name="l00103"></a>00103         }
<a name="l00104"></a>00104     }
<a name="l00105"></a>00105 <span class="preprocessor">    #endif</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (i_ServerSocket &lt; 0)
<a name="l00107"></a>00107     {
<a name="l00108"></a>00108         <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_Error = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00109"></a>00109             .SetString(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">"socket() failed"</span>)
<a name="l00110"></a>00110             .SetString(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">"Echec de la fonction socket()"</span>);
<a name="l00111"></a>00111         m_cliShell.<a class="code" href="classShell.html#65d8db1e2c912ce367a57e474498291d" title="Output stream access.">GetStream</a>(<a class="code" href="shell_8h.html#831be33be460d85af138038078ebd64653988cedf87c54e9e5dcc0e79f86db8e" title="Error stream.">ERROR_STREAM</a>) &lt;&lt; cli_Error.<a class="code" href="classResourceString.html#4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#fae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>()) &lt;&lt; endl;
<a name="l00112"></a>00112         <span class="keywordflow">return</span>;
<a name="l00113"></a>00113     }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115     <span class="keyword">struct </span>sockaddr_in s_SockAddr;
<a name="l00116"></a>00116     s_SockAddr.sin_family = AF_INET;
<a name="l00117"></a>00117     s_SockAddr.sin_port = htons((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>) m_ulTcpPort);
<a name="l00118"></a>00118     s_SockAddr.sin_addr.s_addr = INADDR_ANY;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120     <span class="keywordflow">if</span> (bind(i_ServerSocket, (<span class="keyword">struct</span> sockaddr*) &amp; s_SockAddr, <span class="keyword">sizeof</span>(s_SockAddr)) &lt; 0)
<a name="l00121"></a>00121     {
<a name="l00122"></a>00122         close(i_ServerSocket);
<a name="l00123"></a>00123         <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_Error = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00124"></a>00124             .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">"bind() failed"</span>)
<a name="l00125"></a>00125             .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">"Echec de la fonction bind()"</span>);
<a name="l00126"></a>00126         m_cliShell.<a class="code" href="classShell.html#65d8db1e2c912ce367a57e474498291d" title="Output stream access.">GetStream</a>(<a class="code" href="shell_8h.html#831be33be460d85af138038078ebd64653988cedf87c54e9e5dcc0e79f86db8e" title="Error stream.">ERROR_STREAM</a>) &lt;&lt; cli_Error.<a class="code" href="classResourceString.html#4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#fae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>()) &lt;&lt; endl;
<a name="l00127"></a>00127         <span class="keywordflow">return</span>;
<a name="l00128"></a>00128     }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130     <span class="keywordflow">if</span> (listen(i_ServerSocket, 5) &lt; 0)
<a name="l00131"></a>00131     {
<a name="l00132"></a>00132         close(i_ServerSocket);
<a name="l00133"></a>00133         <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_Error = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00134"></a>00134             .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">"listen() failed"</span>)
<a name="l00135"></a>00135             .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">"Echec de la fonction listen()"</span>);
<a name="l00136"></a>00136         m_cliShell.<a class="code" href="classShell.html#65d8db1e2c912ce367a57e474498291d" title="Output stream access.">GetStream</a>(<a class="code" href="shell_8h.html#831be33be460d85af138038078ebd64653988cedf87c54e9e5dcc0e79f86db8e" title="Error stream.">ERROR_STREAM</a>) &lt;&lt; cli_Error.<a class="code" href="classResourceString.html#4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#fae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>()) &lt;&lt; endl;
<a name="l00137"></a>00137         <span class="keywordflow">return</span>;
<a name="l00138"></a>00138     }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     <span class="keywordflow">while</span> (1)
<a name="l00141"></a>00141     {
<a name="l00142"></a>00142         <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_InfoWaiting = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00143"></a>00143             .SetString(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">"Waiting for clients..."</span>)
<a name="l00144"></a>00144             .SetString(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">"En attente de clients..."</span>);
<a name="l00145"></a>00145         m_cliShell.<a class="code" href="classShell.html#65d8db1e2c912ce367a57e474498291d" title="Output stream access.">GetStream</a>(<a class="code" href="shell_8h.html#831be33be460d85af138038078ebd646457a2dc04a7f380b028fc706855aefb9" title="Output stream.">OUTPUT_STREAM</a>) &lt;&lt; cli_InfoWaiting.<a class="code" href="classResourceString.html#4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#fae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>()) &lt;&lt; endl;
<a name="l00146"></a>00146         <span class="keyword">const</span> <span class="keywordtype">int</span> i_ConnectionSocket = accept(i_ServerSocket, NULL, NULL);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148         <span class="keywordflow">if</span> (i_ConnectionSocket &lt; 0)
<a name="l00149"></a>00149         {
<a name="l00150"></a>00150             close(i_ServerSocket);
<a name="l00151"></a>00151             <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_Error = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00152"></a>00152                 .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">"accept() failed"</span>)
<a name="l00153"></a>00153                 .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">"Echec de la fonction accept()"</span>);
<a name="l00154"></a>00154             m_cliShell.<a class="code" href="classShell.html#65d8db1e2c912ce367a57e474498291d" title="Output stream access.">GetStream</a>(<a class="code" href="shell_8h.html#831be33be460d85af138038078ebd64653988cedf87c54e9e5dcc0e79f86db8e" title="Error stream.">ERROR_STREAM</a>) &lt;&lt; cli_Error.<a class="code" href="classResourceString.html#4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#fae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>()) &lt;&lt; endl;
<a name="l00155"></a>00155             <span class="keywordflow">return</span>;
<a name="l00156"></a>00156         }
<a name="l00157"></a>00157 
<a name="l00158"></a>00158         <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_InfoClient = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00159"></a>00159             .SetString(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">"Accepting telnet connection"</span>)
<a name="l00160"></a>00160             .SetString(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">"Connexion telnet acceptée"</span>);
<a name="l00161"></a>00161         m_cliShell.<a class="code" href="classShell.html#65d8db1e2c912ce367a57e474498291d" title="Output stream access.">GetStream</a>(<a class="code" href="shell_8h.html#831be33be460d85af138038078ebd646457a2dc04a7f380b028fc706855aefb9" title="Output stream.">OUTPUT_STREAM</a>) &lt;&lt; cli_InfoClient.<a class="code" href="classResourceString.html#4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#fae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>()) &lt;&lt; endl;
<a name="l00162"></a>00162         <span class="keywordflow">if</span> (! AcceptConnection(i_ConnectionSocket))
<a name="l00163"></a>00163         {
<a name="l00164"></a>00164             <span class="keywordflow">return</span>;
<a name="l00165"></a>00165         }
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167 }
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 <span class="keyword">const</span> <span class="keywordtype">bool</span> TelnetServer::AcceptConnection(<span class="keyword">const</span> <span class="keywordtype">int</span> I_ConnectionSocket)
<a name="l00170"></a>00170 {
<a name="l00171"></a>00171     <span class="keywordtype">int</span> i_Pid = 0;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 <span class="preprocessor">#ifdef CLI_TELNET_MULTI_CLIENT</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span><span class="preprocessor">    #ifndef CLI_WIN_NETWORK</span>
<a name="l00175"></a>00175 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (i_Pid = fork())
<a name="l00176"></a>00176 <span class="preprocessor">    #else</span>
<a name="l00177"></a>00177 <span class="preprocessor"></span><span class="preprocessor">#error CLI_TELNET_MULTI_CLIENT / CLI_WIN_NETWORK incompatibility. Do not use CLI_TELNET_MULTI_CLIENT when compiling for non POSIX operating systems.</span>
<a name="l00178"></a>00178 <span class="preprocessor"></span><span class="preprocessor">    #endif</span>
<a name="l00179"></a>00179 <span class="preprocessor"></span>    {
<a name="l00180"></a>00180         <span class="comment">// Server side.</span>
<a name="l00181"></a>00181         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00182"></a>00182     }
<a name="l00183"></a>00183     <span class="keywordflow">else</span>
<a name="l00184"></a>00184 <span class="preprocessor">#endif</span>
<a name="l00185"></a>00185 <span class="preprocessor"></span>    {
<a name="l00186"></a>00186         <span class="comment">// Connection side.</span>
<a name="l00187"></a>00187 <span class="preprocessor">#ifndef CLI_WIN_NETWORK</span>
<a name="l00188"></a>00188 <span class="preprocessor"></span>        i_Pid = getpid();
<a name="l00189"></a>00189 <span class="preprocessor">#else</span>
<a name="l00190"></a>00190 <span class="preprocessor"></span>        i_Pid = GetCurrentThreadId();
<a name="l00191"></a>00191 <span class="preprocessor">#endif</span>
<a name="l00192"></a>00192 <span class="preprocessor"></span>        <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_InfoStart = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00193"></a>00193             .SetString(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">"Connection started"</span>)
<a name="l00194"></a>00194             .SetString(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">"Début de connexion"</span>);
<a name="l00195"></a>00195         m_cliShell.<a class="code" href="classShell.html#65d8db1e2c912ce367a57e474498291d" title="Output stream access.">GetStream</a>(<a class="code" href="shell_8h.html#831be33be460d85af138038078ebd646457a2dc04a7f380b028fc706855aefb9" title="Output stream.">OUTPUT_STREAM</a>)
<a name="l00196"></a>00196             &lt;&lt; cli_InfoStart.<a class="code" href="classResourceString.html#4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#fae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>())
<a name="l00197"></a>00197             &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; i_Pid &lt;&lt; cli::endl;
<a name="l00198"></a>00198         <span class="keywordflow">if</span> (<a class="code" href="classTelnetConnection.html" title="Telnet connection input/output device.">TelnetConnection</a>* <span class="keyword">const</span> pcli_Connection = <span class="keyword">new</span> <a class="code" href="classTelnetConnection.html" title="Telnet connection input/output device.">TelnetConnection</a>(m_cliShell, I_ConnectionSocket, <span class="keyword">true</span>))
<a name="l00199"></a>00199         {
<a name="l00200"></a>00200             pcli_Connection-&gt;UseInstance(<a class="code" href="debug_8h.html#12506d620d4ecd0161866c9b19d761ed" title="Call information filling.">__CALL_INFO__</a>);
<a name="l00201"></a>00201             m_cliShell.<a class="code" href="classShell.html#678c17eba603acfa45838a710b50a76c" title="Runs the shell onto the corresponding input/output device.">Run</a>(*pcli_Connection);
<a name="l00202"></a>00202             pcli_Connection-&gt;FreeInstance(<a class="code" href="debug_8h.html#12506d620d4ecd0161866c9b19d761ed" title="Call information filling.">__CALL_INFO__</a>);
<a name="l00203"></a>00203         }
<a name="l00204"></a>00204         <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_InfoEnd = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00205"></a>00205             .SetString(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">"Connection done"</span>)
<a name="l00206"></a>00206             .SetString(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">"Début de connexion"</span>);
<a name="l00207"></a>00207         m_cliShell.<a class="code" href="classShell.html#65d8db1e2c912ce367a57e474498291d" title="Output stream access.">GetStream</a>(<a class="code" href="shell_8h.html#831be33be460d85af138038078ebd646457a2dc04a7f380b028fc706855aefb9" title="Output stream.">OUTPUT_STREAM</a>)
<a name="l00208"></a>00208             &lt;&lt; cli_InfoEnd.<a class="code" href="classResourceString.html#4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#fae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>())
<a name="l00209"></a>00209             &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; i_Pid &lt;&lt; cli::endl;
<a name="l00210"></a>00210 <span class="preprocessor">#ifdef CLI_TELNET_MULTI_CLIENT</span>
<a name="l00211"></a>00211 <span class="preprocessor"></span>        exit(0);
<a name="l00212"></a>00212 <span class="preprocessor">#endif</span>
<a name="l00213"></a>00213 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00214"></a>00214     }
<a name="l00215"></a>00215 }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 TelnetConnection::TelnetConnection(
<a name="l00219"></a>00219         <a class="code" href="classShell.html" title="Shell management.">Shell</a>&amp; CLI_Shell,
<a name="l00220"></a>00220         <span class="keyword">const</span> <span class="keywordtype">int</span> I_ConnectionSocket,
<a name="l00221"></a>00221         <span class="keyword">const</span> <span class="keywordtype">bool</span> B_AutoDelete)
<a name="l00222"></a>00222   : <a class="code" href="classIODevice.html" title="Generic input/output device.">IODevice</a>(<span class="stringliteral">"telnet"</span>, B_AutoDelete),
<a name="l00223"></a>00223     m_iSocket(I_ConnectionSocket),
<a name="l00224"></a>00224     m_qChars(<a class="code" href="preprocessing_8h.html#c9caea23061b23d302f307a82a8ae779" title="Size of telnet input buffer.">CLI_TELNET_INPUT_BUFFER_SIZE</a>)
<a name="l00225"></a>00225 {
<a name="l00226"></a>00226 }
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 <a class="code" href="classTelnetConnection.html#8689fb73dc61bbb43d8c72521d9a7d81" title="Destructor.">TelnetConnection::~TelnetConnection</a>(<span class="keywordtype">void</span>)
<a name="l00229"></a>00229 {
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classTelnetConnection.html#e87d5ea164dbdabb856c34db2b621a7c" title="Open device handler.">TelnetConnection::OpenDevice</a>(<span class="keywordtype">void</span>)
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00235"></a>00235 }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237 <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classTelnetConnection.html#c7acd3e206a292f35f55c1b5d4597f7c" title="Close device handler.">TelnetConnection::CloseDevice</a>(<span class="keywordtype">void</span>)
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239 <span class="preprocessor">#ifdef CLI_TELNET_MULTI_CLIENT</span>
<a name="l00240"></a>00240 <span class="preprocessor"></span>    close(m_iSocket);
<a name="l00241"></a>00241 <span class="preprocessor">#endif</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00243"></a>00243 }
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 <span class="keyword">const</span> <a class="code" href="io__device_8h.html#90d295cf6b6bc9873c186cc8851147f8" title="Input characters.">KEY</a> <a class="code" href="classTelnetConnection.html#e3858fcf54afc30be3a18370b0623eac" title="Character input handler.">TelnetConnection::GetKey</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00246"></a>00246 <span class="keyword"></span>{
<a name="l00247"></a>00247     <span class="keywordflow">if</span> (! m_qChars.IsEmpty())
<a name="l00248"></a>00248     {
<a name="l00249"></a>00249         <span class="comment">// Dequeue the received characters</span>
<a name="l00250"></a>00250         <span class="keyword">const</span> <span class="keywordtype">int</span> i_Front = m_qChars.RemoveHead();
<a name="l00251"></a>00251         <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">"i_Char = "</span> &lt;&lt; i_Front &lt;&lt; <a class="code" href="io__device_8h.html#d6d7d55b8cc249130097ce4007a1162a">endl</a>;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253         <span class="comment">// Special character management.</span>
<a name="l00254"></a>00254         <span class="keywordflow">switch</span> (i_Front)
<a name="l00255"></a>00255         {
<a name="l00256"></a>00256         <span class="keywordflow">case</span> 1:     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471eed3bac3a74a2eaf9a84d1a9774b67c1" title="Begin key.">KEY_BEGIN</a>;   <span class="comment">// CTRL+A</span>
<a name="l00257"></a>00257         <span class="keywordflow">case</span> 3:     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc2704719524d094809858b9e4f778763913568a" title="Break (Ctrl+C).">BREAK</a>;       <span class="comment">// CTRL+C</span>
<a name="l00258"></a>00258         <span class="keywordflow">case</span> 4:     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc27047186d6ca369e69a3a0f0c9bd063dd39a70" title="Logout (Ctrl+D).">LOGOUT</a>;      <span class="comment">// CTRL+D</span>
<a name="l00259"></a>00259         <span class="keywordflow">case</span> 5:     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471a8adb6fcb92dec58fb19410eacfdd403" title="End key.">KEY_END</a>;     <span class="comment">// CTRL+E</span>
<a name="l00260"></a>00260         <span class="keywordflow">case</span> 8:     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471d2534cebcf6f430484b7c931dd657ddc" title="Backspace.">BACKSPACE</a>;   <span class="comment">// CTRL+H</span>
<a name="l00261"></a>00261         <span class="keywordflow">case</span> 13:
<a name="l00262"></a>00262             <span class="keywordflow">if</span> (! m_qChars.IsEmpty())
<a name="l00263"></a>00263             {
<a name="l00264"></a>00264                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">"i_Char2 = "</span> &lt;&lt; m_qChars.GetHead() &lt;&lt; endl;
<a name="l00265"></a>00265                 <span class="keywordflow">if</span> (m_qChars.GetHead() == 10)
<a name="l00266"></a>00266                 {
<a name="l00267"></a>00267                     <span class="comment">// Process only the character 13 when the sequence is 13-10.</span>
<a name="l00268"></a>00268                     m_qChars.RemoveHead();
<a name="l00269"></a>00269                     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471951ab68bb8f7daafb78951107080904e" title="Enter.">ENTER</a>;
<a name="l00270"></a>00270                 }
<a name="l00271"></a>00271             }
<a name="l00272"></a>00272             <span class="keywordflow">break</span>;
<a name="l00273"></a>00273         <span class="keywordflow">case</span> 12:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471a5e0d06ffc1b0ee32eda539e6528a3e6" title="Clean screen key.">CLS</a>;         <span class="comment">// CTRL+L</span>
<a name="l00274"></a>00274         <span class="keywordflow">case</span> 14:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471b13b96bf99a409e019f70dc1602532fd" title="Forward key.">NEXT</a>;        <span class="comment">// CTRL+N</span>
<a name="l00275"></a>00275         <span class="keywordflow">case</span> 16:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471d9600a436d5cc272dfd53f6c45fdeca4" title="Previous key.">PREVIOUS</a>;    <span class="comment">// CTRL+P</span>
<a name="l00276"></a>00276         <span class="keywordflow">case</span> 25:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471d20f1b79e9cfc073db19741638050449" title="Redo.">REDO</a>;        <span class="comment">// CTRL+Y</span>
<a name="l00277"></a>00277         <span class="keywordflow">case</span> 26:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc27047122a937c23ef109ac28176b98dacad9c6" title="Undo.">UNDO</a>;        <span class="comment">// CTRL+Z</span>
<a name="l00278"></a>00278         <span class="keywordflow">case</span> 27:
<a name="l00279"></a>00279             <span class="keywordflow">if</span> (! m_qChars.IsEmpty())
<a name="l00280"></a>00280             {
<a name="l00281"></a>00281                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">"i_Char2 = "</span> &lt;&lt; m_qChars.GetHead() &lt;&lt; endl;
<a name="l00282"></a>00282                 <span class="keywordflow">if</span> (m_qChars.GetHead() == 91)
<a name="l00283"></a>00283                 {
<a name="l00284"></a>00284                     m_qChars.RemoveHead();
<a name="l00285"></a>00285 
<a name="l00286"></a>00286                     <span class="keywordflow">if</span> (! m_qChars.IsEmpty())
<a name="l00287"></a>00287                     {
<a name="l00288"></a>00288                         <span class="keyword">const</span> <span class="keywordtype">int</span> i_Special = m_qChars.RemoveHead();
<a name="l00289"></a>00289                         <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">"i_Char3 = "</span> &lt;&lt; i_Special &lt;&lt; endl;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291                         <span class="keywordflow">switch</span> (i_Special)
<a name="l00292"></a>00292                         {
<a name="l00293"></a>00293                         <span class="comment">// All characters that will be followed by a 126 character.</span>
<a name="l00294"></a>00294                         <span class="keywordflow">case</span> 49: <span class="comment">// INSERT</span>
<a name="l00295"></a>00295                         <span class="keywordflow">case</span> 50: <span class="comment">// KEY_BEGIN;</span>
<a name="l00296"></a>00296                         <span class="keywordflow">case</span> 51: <span class="comment">// PAGE_UP;</span>
<a name="l00297"></a>00297                         <span class="keywordflow">case</span> 52: <span class="comment">// DELETE;</span>
<a name="l00298"></a>00298                         <span class="keywordflow">case</span> 53: <span class="comment">// KEY_END;</span>
<a name="l00299"></a>00299                         <span class="keywordflow">case</span> 54: <span class="comment">// PAGE_DOWN;</span>
<a name="l00300"></a>00300                             <span class="keywordflow">if</span> (! m_qChars.IsEmpty())
<a name="l00301"></a>00301                             {
<a name="l00302"></a>00302                                 <span class="keyword">const</span> <span class="keywordtype">int</span> i_Finish = m_qChars.RemoveHead();
<a name="l00303"></a>00303                                 <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">"i_Char4 = "</span> &lt;&lt; i_Finish &lt;&lt; endl;
<a name="l00304"></a>00304 
<a name="l00305"></a>00305                                 <span class="keywordflow">if</span> (i_Finish == 126)
<a name="l00306"></a>00306                                 {
<a name="l00307"></a>00307                                     <span class="keywordflow">switch</span> (i_Special)
<a name="l00308"></a>00308                                     {
<a name="l00309"></a>00309                                     <span class="keywordflow">case</span> 49: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471a15c451953b2d2a93403afe786930d0f" title="Insert key.">INSERT</a>;
<a name="l00310"></a>00310                                     <span class="keywordflow">case</span> 50: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471eed3bac3a74a2eaf9a84d1a9774b67c1" title="Begin key.">KEY_BEGIN</a>;
<a name="l00311"></a>00311                                     <span class="keywordflow">case</span> 51: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc2704710442824c041b9618cd7c512205e7e6dc" title="Page up arrow key.">PAGE_UP</a>;
<a name="l00312"></a>00312                                     <span class="keywordflow">case</span> 52: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc2704719d61e82a9a12752f10aece1b22183913" title="Delete key.">DELETE</a>;
<a name="l00313"></a>00313                                     <span class="keywordflow">case</span> 53: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471a8adb6fcb92dec58fb19410eacfdd403" title="End key.">KEY_END</a>;
<a name="l00314"></a>00314                                     <span class="keywordflow">case</span> 54: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471714c5d27586a8bcbab274d9176da1539" title="Page down arrow key.">PAGE_DOWN</a>;
<a name="l00315"></a>00315                                     }
<a name="l00316"></a>00316                                 }
<a name="l00317"></a>00317                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_Special == 49) &amp;&amp; (! m_qChars.IsEmpty()))
<a name="l00318"></a>00318                                 {
<a name="l00319"></a>00319                                     <span class="comment">// Function keys.</span>
<a name="l00320"></a>00320                                     <span class="keyword">const</span> <span class="keywordtype">int</span> i_Function = i_Finish;
<a name="l00321"></a>00321                                     <span class="keyword">const</span> <span class="keywordtype">int</span> i_FunctionFinish = m_qChars.RemoveHead();
<a name="l00322"></a>00322                                     <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">"i_Char5 = "</span> &lt;&lt; i_FunctionFinish &lt;&lt; endl;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324                                     <span class="keywordflow">if</span> (i_FunctionFinish == 126)
<a name="l00325"></a>00325                                     {
<a name="l00326"></a>00326                                         <span class="keywordflow">switch</span> (i_Function)
<a name="l00327"></a>00327                                         {
<a name="l00328"></a>00328                                         <span class="keywordflow">case</span> 49: <span class="keywordflow">return</span> F1;
<a name="l00329"></a>00329                                         <span class="keywordflow">case</span> 50: <span class="keywordflow">return</span> F2;
<a name="l00330"></a>00330                                         <span class="keywordflow">case</span> 51: <span class="keywordflow">return</span> F3;
<a name="l00331"></a>00331                                         <span class="keywordflow">case</span> 52: <span class="keywordflow">return</span> F4;
<a name="l00332"></a>00332                                         <span class="keywordflow">case</span> 53: <span class="keywordflow">return</span> F5;
<a name="l00333"></a>00333                                         <span class="keywordflow">case</span> 55: <span class="keywordflow">return</span> F6;
<a name="l00334"></a>00334                                         <span class="keywordflow">case</span> 56: <span class="keywordflow">return</span> F7;
<a name="l00335"></a>00335                                         <span class="keywordflow">case</span> 57: <span class="keywordflow">return</span> F8;
<a name="l00336"></a>00336                                         }
<a name="l00337"></a>00337                                     }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339                                     <span class="comment">// Unhandled.</span>
<a name="l00340"></a>00340                                     <span class="keywordflow">if</span> (! m_qChars.AddHead(i_FunctionFinish))
<a name="l00341"></a>00341                                     {
<a name="l00342"></a>00342                                         <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="traces_8h.html#243b1b1f8ca7e7e98ac73a2d115256f4" title="Internal error common trace class singleton redirection.">INTERNAL_ERROR</a>)
<a name="l00343"></a>00343                                             &lt;&lt; <span class="stringliteral">"TelnetConnection::GetKey(): "</span>
<a name="l00344"></a>00344                                             &lt;&lt; <span class="stringliteral">"Unable to restore previously removed character from m_qChars"</span>
<a name="l00345"></a>00345                                             &lt;&lt; endl;
<a name="l00346"></a>00346                                     }
<a name="l00347"></a>00347                                 }
<a name="l00348"></a>00348                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_Special == 50) &amp;&amp; (! m_qChars.IsEmpty()))
<a name="l00349"></a>00349                                 {
<a name="l00350"></a>00350                                     <span class="comment">// Function keys.</span>
<a name="l00351"></a>00351                                     <span class="keyword">const</span> <span class="keywordtype">int</span> i_Function = i_Finish;
<a name="l00352"></a>00352                                     <span class="keyword">const</span> <span class="keywordtype">int</span> i_FunctionFinish = m_qChars.RemoveHead();
<a name="l00353"></a>00353                                     <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">"i_Char5 = "</span> &lt;&lt; i_FunctionFinish &lt;&lt; endl;
<a name="l00354"></a>00354 
<a name="l00355"></a>00355                                     <span class="keywordflow">if</span> (i_FunctionFinish == 126)
<a name="l00356"></a>00356                                     {
<a name="l00357"></a>00357                                         <span class="keywordflow">switch</span> (i_Function)
<a name="l00358"></a>00358                                         {
<a name="l00359"></a>00359                                         <span class="keywordflow">case</span> 48: <span class="keywordflow">return</span> F9;
<a name="l00360"></a>00360                                         <span class="keywordflow">case</span> 49: <span class="keywordflow">return</span> F10;
<a name="l00361"></a>00361                                         <span class="keywordflow">case</span> 51: <span class="keywordflow">return</span> F11;
<a name="l00362"></a>00362                                         <span class="keywordflow">case</span> 52: <span class="keywordflow">return</span> F12;
<a name="l00363"></a>00363                                         }
<a name="l00364"></a>00364                                     }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366                                     <span class="comment">// Unhandled.</span>
<a name="l00367"></a>00367                                     <span class="keywordflow">if</span> (! m_qChars.AddHead(i_FunctionFinish))
<a name="l00368"></a>00368                                     {
<a name="l00369"></a>00369                                         <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="traces_8h.html#243b1b1f8ca7e7e98ac73a2d115256f4" title="Internal error common trace class singleton redirection.">INTERNAL_ERROR</a>)
<a name="l00370"></a>00370                                             &lt;&lt; <span class="stringliteral">"TelnetConnection::GetKey(): "</span>
<a name="l00371"></a>00371                                             &lt;&lt; <span class="stringliteral">"Unable to restore previously removed character from m_qChars"</span>
<a name="l00372"></a>00372                                             &lt;&lt; endl;
<a name="l00373"></a>00373                                     }
<a name="l00374"></a>00374                                 }
<a name="l00375"></a>00375 
<a name="l00376"></a>00376                                 <span class="comment">// Unhandled.</span>
<a name="l00377"></a>00377                                 <span class="keywordflow">if</span> (! m_qChars.AddHead(i_Finish))
<a name="l00378"></a>00378                                 {
<a name="l00379"></a>00379                                     <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="traces_8h.html#243b1b1f8ca7e7e98ac73a2d115256f4" title="Internal error common trace class singleton redirection.">INTERNAL_ERROR</a>)
<a name="l00380"></a>00380                                         &lt;&lt; <span class="stringliteral">"TelnetConnection::GetKey(): "</span>
<a name="l00381"></a>00381                                         &lt;&lt; <span class="stringliteral">"Unable to restore previously removed character from m_qChars"</span>
<a name="l00382"></a>00382                                         &lt;&lt; endl;
<a name="l00383"></a>00383                                 }
<a name="l00384"></a>00384                             }
<a name="l00385"></a>00385                         <span class="keywordflow">case</span> 65: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc2704710848a442d907968b211b97bc2bd88acd" title="Up arrow key.">KEY_UP</a>;
<a name="l00386"></a>00386                         <span class="keywordflow">case</span> 66: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471a9cdac7967bf7d88fdb761138a2a3416" title="Down arrow key.">KEY_DOWN</a>;
<a name="l00387"></a>00387                         <span class="keywordflow">case</span> 67: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc2704716504370d9c6391e1a9da6a1a529b089d" title="Right arrow key.">KEY_RIGHT</a>;
<a name="l00388"></a>00388                         <span class="keywordflow">case</span> 68: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471612120b69c7dfd46086db7aaebdbcf65" title="Left arrow key.">KEY_LEFT</a>;
<a name="l00389"></a>00389                         }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391                         <span class="comment">// Unhandled.</span>
<a name="l00392"></a>00392                         <span class="keywordflow">if</span> (! m_qChars.AddHead(i_Special))
<a name="l00393"></a>00393                         {
<a name="l00394"></a>00394                             <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="traces_8h.html#243b1b1f8ca7e7e98ac73a2d115256f4" title="Internal error common trace class singleton redirection.">INTERNAL_ERROR</a>)
<a name="l00395"></a>00395                                 &lt;&lt; <span class="stringliteral">"TelnetConnection::GetKey(): "</span>
<a name="l00396"></a>00396                                 &lt;&lt; <span class="stringliteral">"Unable to restore previously removed character from m_qChars"</span>
<a name="l00397"></a>00397                                 &lt;&lt; endl;
<a name="l00398"></a>00398                         }
<a name="l00399"></a>00399                     }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401                     <span class="comment">// Unhandled.</span>
<a name="l00402"></a>00402                     <span class="keywordflow">if</span> (! m_qChars.AddHead(91))
<a name="l00403"></a>00403                     {
<a name="l00404"></a>00404                         <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="traces_8h.html#243b1b1f8ca7e7e98ac73a2d115256f4" title="Internal error common trace class singleton redirection.">INTERNAL_ERROR</a>)
<a name="l00405"></a>00405                             &lt;&lt; <span class="stringliteral">"TelnetConnection::GetKey(): "</span>
<a name="l00406"></a>00406                             &lt;&lt; <span class="stringliteral">"Unable to restore previously removed character from m_qChars"</span>
<a name="l00407"></a>00407                             &lt;&lt; endl;
<a name="l00408"></a>00408                     }
<a name="l00409"></a>00409                 }
<a name="l00410"></a>00410             }
<a name="l00411"></a>00411             <span class="keywordflow">else</span>
<a name="l00412"></a>00412             {
<a name="l00413"></a>00413                 <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc2704710a311695a4f6c56869245418bebeb33d" title="Escape.">ESCAPE</a>;
<a name="l00414"></a>00414             }
<a name="l00415"></a>00415             <span class="keywordflow">break</span>;
<a name="l00416"></a>00416         <span class="keywordflow">case</span> 96:    <span class="keywordflow">return</span> BACK_QUOTE;
<a name="l00417"></a>00417         <span class="keywordflow">case</span> 126:   <span class="keywordflow">return</span> TILDE;
<a name="l00418"></a>00418         <span class="keywordflow">case</span> 127:   <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc2704719d61e82a9a12752f10aece1b22183913" title="Delete key.">DELETE</a>;
<a name="l00419"></a>00419 
<a name="l00420"></a>00420         <span class="comment">// Accentuated characters.</span>
<a name="l00421"></a>00421         <span class="keywordflow">case</span> -31:   <span class="keywordflow">return</span> KEY_aacute;
<a name="l00422"></a>00422         <span class="keywordflow">case</span> -32:   <span class="keywordflow">return</span> KEY_agrave;
<a name="l00423"></a>00423         <span class="keywordflow">case</span> -28:   <span class="keywordflow">return</span> KEY_auml;
<a name="l00424"></a>00424         <span class="keywordflow">case</span> -30:   <span class="keywordflow">return</span> KEY_acirc;
<a name="l00425"></a>00425         <span class="keywordflow">case</span> -25:   <span class="keywordflow">return</span> KEY_ccedil;
<a name="l00426"></a>00426         <span class="keywordflow">case</span> -23:   <span class="keywordflow">return</span> KEY_eacute;
<a name="l00427"></a>00427         <span class="keywordflow">case</span> -24:   <span class="keywordflow">return</span> KEY_egrave;
<a name="l00428"></a>00428         <span class="keywordflow">case</span> -21:   <span class="keywordflow">return</span> KEY_euml;
<a name="l00429"></a>00429         <span class="keywordflow">case</span> -22:   <span class="keywordflow">return</span> KEY_ecirc;
<a name="l00430"></a>00430         <span class="keywordflow">case</span> -19:   <span class="keywordflow">return</span> KEY_iacute;
<a name="l00431"></a>00431         <span class="keywordflow">case</span> -20:   <span class="keywordflow">return</span> KEY_igrave;
<a name="l00432"></a>00432         <span class="keywordflow">case</span> -17:   <span class="keywordflow">return</span> KEY_iuml;
<a name="l00433"></a>00433         <span class="keywordflow">case</span> -18:   <span class="keywordflow">return</span> KEY_icirc;
<a name="l00434"></a>00434         <span class="keywordflow">case</span> -13:   <span class="keywordflow">return</span> KEY_oacute;
<a name="l00435"></a>00435         <span class="keywordflow">case</span> -14:   <span class="keywordflow">return</span> KEY_ograve;
<a name="l00436"></a>00436         <span class="keywordflow">case</span> -10:   <span class="keywordflow">return</span> KEY_ouml;
<a name="l00437"></a>00437         <span class="keywordflow">case</span> -12:   <span class="keywordflow">return</span> KEY_ocirc;
<a name="l00438"></a>00438         <span class="keywordflow">case</span> -6:    <span class="keywordflow">return</span> KEY_uacute;
<a name="l00439"></a>00439         <span class="keywordflow">case</span> -7:    <span class="keywordflow">return</span> KEY_ugrave;
<a name="l00440"></a>00440         <span class="keywordflow">case</span> -4:    <span class="keywordflow">return</span> KEY_uuml;
<a name="l00441"></a>00441         <span class="keywordflow">case</span> -5:    <span class="keywordflow">return</span> KEY_ucirc;
<a name="l00442"></a>00442         <span class="comment">// Accentuated characters copied from the output itself.</span>
<a name="l00443"></a>00443         <span class="keywordflow">case</span> -96:   <span class="keywordflow">return</span> KEY_aacute;
<a name="l00444"></a>00444         <span class="keywordflow">case</span> -123:  <span class="keywordflow">return</span> KEY_agrave;
<a name="l00445"></a>00445         <span class="keywordflow">case</span> -124:  <span class="keywordflow">return</span> KEY_auml;
<a name="l00446"></a>00446         <span class="keywordflow">case</span> -125:  <span class="keywordflow">return</span> KEY_acirc;
<a name="l00447"></a>00447         <span class="keywordflow">case</span> -121:  <span class="keywordflow">return</span> KEY_ccedil;
<a name="l00448"></a>00448         <span class="keywordflow">case</span> -126:  <span class="keywordflow">return</span> KEY_eacute;
<a name="l00449"></a>00449         <span class="keywordflow">case</span> -118:  <span class="keywordflow">return</span> KEY_egrave;
<a name="l00450"></a>00450         <span class="keywordflow">case</span> -119:  <span class="keywordflow">return</span> KEY_euml;
<a name="l00451"></a>00451         <span class="keywordflow">case</span> -120:  <span class="keywordflow">return</span> KEY_ecirc;
<a name="l00452"></a>00452         <span class="keywordflow">case</span> -95:   <span class="keywordflow">return</span> KEY_iacute;
<a name="l00453"></a>00453         <span class="keywordflow">case</span> -115:  <span class="keywordflow">return</span> KEY_igrave;
<a name="l00454"></a>00454         <span class="keywordflow">case</span> -117:  <span class="keywordflow">return</span> KEY_iuml;
<a name="l00455"></a>00455         <span class="keywordflow">case</span> -116:  <span class="keywordflow">return</span> KEY_icirc;
<a name="l00456"></a>00456         <span class="keywordflow">case</span> -94:   <span class="keywordflow">return</span> KEY_oacute;
<a name="l00457"></a>00457         <span class="keywordflow">case</span> -107:  <span class="keywordflow">return</span> KEY_ograve;
<a name="l00458"></a>00458         <span class="keywordflow">case</span> -108:  <span class="keywordflow">return</span> KEY_ouml;
<a name="l00459"></a>00459         <span class="keywordflow">case</span> -109:  <span class="keywordflow">return</span> KEY_ocirc;
<a name="l00460"></a>00460         <span class="comment">//case -93:   return KEY_uacute;    // Conflicts with POUND!</span>
<a name="l00461"></a>00461         <span class="keywordflow">case</span> -105:  <span class="keywordflow">return</span> KEY_ugrave;
<a name="l00462"></a>00462         <span class="keywordflow">case</span> -127:  <span class="keywordflow">return</span> KEY_uuml;
<a name="l00463"></a>00463         <span class="keywordflow">case</span> -106:  <span class="keywordflow">return</span> KEY_ucirc;
<a name="l00464"></a>00464 
<a name="l00465"></a>00465         <span class="comment">// Special characters.</span>
<a name="l00466"></a>00466         <span class="keywordflow">case</span> -75:   <span class="keywordflow">return</span> MICRO;
<a name="l00467"></a>00467         <span class="keywordflow">case</span> -26:   <span class="keywordflow">return</span> MICRO;       <span class="comment">// Copied from the output itself.</span>
<a name="l00468"></a>00468         <span class="keywordflow">case</span> -78:   <span class="keywordflow">return</span> SQUARE;
<a name="l00469"></a>00469         <span class="keywordflow">case</span> -3:    <span class="keywordflow">return</span> SQUARE;      <span class="comment">// Copied from the output itself.</span>
<a name="l00470"></a>00470         <span class="keywordflow">case</span> -80:   <span class="keywordflow">return</span> DEGREE;
<a name="l00471"></a>00471         <span class="keywordflow">case</span> -8:    <span class="keywordflow">return</span> DEGREE;      <span class="comment">// Copied from the output itself.</span>
<a name="l00472"></a>00472         <span class="keywordflow">case</span> -87:   <span class="keywordflow">return</span> COPYRIGHT;
<a name="l00473"></a>00473         <span class="keywordflow">case</span> -72:   <span class="keywordflow">return</span> COPYRIGHT;   <span class="comment">// Copied from the output itself.</span>
<a name="l00474"></a>00474         <span class="keywordflow">case</span> -89:   <span class="keywordflow">return</span> PARAGRAPH;
<a name="l00475"></a>00475         <span class="keywordflow">case</span> -11:   <span class="keywordflow">return</span> PARAGRAPH;   <span class="comment">// Copied from the output itself.</span>
<a name="l00476"></a>00476         <span class="keywordflow">case</span> -93:   <span class="keywordflow">return</span> POUND;
<a name="l00477"></a>00477         <span class="keywordflow">case</span> -100:  <span class="keywordflow">return</span> POUND;       <span class="comment">// Copied from the output itself.</span>
<a name="l00478"></a>00478         <span class="keywordflow">case</span> -128:  <span class="keywordflow">return</span> EURO;
<a name="l00479"></a>00479         <span class="keywordflow">case</span> -79:   <span class="keywordflow">return</span> EURO;    <span class="comment">// Copied from the output itself.</span>
<a name="l00480"></a>00480         }
<a name="l00481"></a>00481 
<a name="l00482"></a>00482         <span class="comment">// Unhandled</span>
<a name="l00483"></a>00483         <span class="comment">// Use default behaviour.</span>
<a name="l00484"></a>00484         <span class="keyword">const</span> <a class="code" href="io__device_8h.html#90d295cf6b6bc9873c186cc8851147f8" title="Input characters.">KEY</a> e_Char = <a class="code" href="classTelnetConnection.html#e3858fcf54afc30be3a18370b0623eac" title="Character input handler.">IODevice::GetKey</a>(i_Front);
<a name="l00485"></a>00485         <span class="keywordflow">if</span> (e_Char != <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471e42682039e1a584113718465a202d0c0" title="Null key.">NULL_KEY</a>)
<a name="l00486"></a>00486         {
<a name="l00487"></a>00487             <span class="keywordflow">return</span> e_Char;
<a name="l00488"></a>00488         }
<a name="l00489"></a>00489         <span class="keywordflow">else</span>
<a name="l00490"></a>00490         {
<a name="l00491"></a>00491             <span class="comment">// Unknown character.</span>
<a name="l00492"></a>00492             <span class="keywordflow">return</span> <a class="code" href="classTelnetConnection.html#e3858fcf54afc30be3a18370b0623eac" title="Character input handler.">GetKey</a>();
<a name="l00493"></a>00493         }
<a name="l00494"></a>00494     }
<a name="l00495"></a>00495     <span class="keywordflow">else</span>
<a name="l00496"></a>00496     {
<a name="l00497"></a>00497         <span class="comment">// Wait for characters</span>
<a name="l00498"></a>00498         <span class="keywordtype">char</span> str_Buffer[256];
<a name="l00499"></a>00499         <span class="keyword">const</span> <span class="keywordtype">int</span> i_Len = recv(m_iSocket, str_Buffer, 256, 0);
<a name="l00500"></a>00500         <span class="keywordflow">if</span> (i_Len &lt;= 0)
<a name="l00501"></a>00501         {
<a name="l00502"></a>00502             <a class="code" href="classOutputDevice.html#c831dff60351f1a3dffd667e175e8f23" title="Last error.">m_cliLastError</a>
<a name="l00503"></a>00503                 .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">"Telnet reception error"</span>)
<a name="l00504"></a>00504                 .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">"Echec de réception en telnet"</span>);
<a name="l00505"></a>00505             <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#87c1c1677bb8199c62a3de0ebc270471e42682039e1a584113718465a202d0c0" title="Null key.">NULL_KEY</a>;
<a name="l00506"></a>00506         }
<a name="l00507"></a>00507         <span class="keywordflow">else</span>
<a name="l00508"></a>00508         {
<a name="l00509"></a>00509             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;i_Len; i++)
<a name="l00510"></a>00510             {
<a name="l00511"></a>00511                 <span class="keywordflow">if</span> (str_Buffer[i] != <span class="charliteral">'\0'</span>)
<a name="l00512"></a>00512                 {
<a name="l00513"></a>00513                     <span class="keywordflow">if</span> (! m_qChars.AddTail(str_Buffer[i]))
<a name="l00514"></a>00514                     {
<a name="l00515"></a>00515                         <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="traces_8h.html#243b1b1f8ca7e7e98ac73a2d115256f4" title="Internal error common trace class singleton redirection.">INTERNAL_ERROR</a>)
<a name="l00516"></a>00516                             &lt;&lt; <span class="stringliteral">"TelnetConnection::GetKey(): "</span>
<a name="l00517"></a>00517                             &lt;&lt; <span class="stringliteral">"Could not append character '"</span> &lt;&lt; str_Buffer[i] &lt;&lt; <span class="stringliteral">"' "</span>
<a name="l00518"></a>00518                             &lt;&lt; <span class="stringliteral">"to m_qChars"</span> &lt;&lt; endl;
<a name="l00519"></a>00519                     }
<a name="l00520"></a>00520                 }
<a name="l00521"></a>00521             }
<a name="l00522"></a>00522             <span class="keywordflow">return</span> <a class="code" href="classTelnetConnection.html#e3858fcf54afc30be3a18370b0623eac" title="Character input handler.">GetKey</a>();
<a name="l00523"></a>00523         }
<a name="l00524"></a>00524     }
<a name="l00525"></a>00525 }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527 <span class="keywordtype">void</span> <a class="code" href="classTelnetConnection.html#bd3418d5f2a6d620406616e1aa5c7f1f" title="Output handler.">TelnetConnection::PutString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> STR_Out)<span class="keyword"> const</span>
<a name="l00528"></a>00528 <span class="keyword"></span>{
<a name="l00529"></a>00529     <span class="keywordflow">if</span> (STR_Out != NULL)
<a name="l00530"></a>00530     {
<a name="l00531"></a>00531         <span class="keyword">const</span> <span class="keywordtype">int</span> i_StringLen = (int) strlen(STR_Out);
<a name="l00532"></a>00532         <span class="keywordflow">if</span> (i_StringLen &gt; 0)
<a name="l00533"></a>00533         <span class="keywordflow">if</span> (<span class="keywordtype">char</span>* <span class="keyword">const</span> str_Out = <span class="keyword">new</span> <span class="keywordtype">char</span>[i_StringLen + 1])
<a name="l00534"></a>00534         {
<a name="l00535"></a>00535             memcpy(str_Out, STR_Out, i_StringLen + 1);
<a name="l00536"></a>00536 
<a name="l00537"></a>00537             <span class="comment">// Conversions.</span>
<a name="l00538"></a>00538             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;i_StringLen; i++)
<a name="l00539"></a>00539             {
<a name="l00540"></a>00540                 <span class="keywordflow">switch</span> (str_Out[i])
<a name="l00541"></a>00541                 {
<a name="l00542"></a>00542                 <span class="keywordflow">case</span> KEY_aacute:    str_Out[i] = (char) -96;    <span class="keywordflow">break</span>;
<a name="l00543"></a>00543                 <span class="keywordflow">case</span> KEY_agrave:    str_Out[i] = (char) -123;   <span class="keywordflow">break</span>;
<a name="l00544"></a>00544                 <span class="keywordflow">case</span> KEY_auml:      str_Out[i] = (char) -124;   <span class="keywordflow">break</span>;
<a name="l00545"></a>00545                 <span class="keywordflow">case</span> KEY_acirc:     str_Out[i] = (char) -125;   <span class="keywordflow">break</span>;
<a name="l00546"></a>00546                 <span class="keywordflow">case</span> KEY_ccedil:    str_Out[i] = (char) -121;   <span class="keywordflow">break</span>;
<a name="l00547"></a>00547                 <span class="keywordflow">case</span> KEY_eacute:    str_Out[i] = (char) -126;   <span class="keywordflow">break</span>;
<a name="l00548"></a>00548                 <span class="keywordflow">case</span> KEY_egrave:    str_Out[i] = (char) -118;   <span class="keywordflow">break</span>;
<a name="l00549"></a>00549                 <span class="keywordflow">case</span> KEY_euml:      str_Out[i] = (char) -119;   <span class="keywordflow">break</span>;
<a name="l00550"></a>00550                 <span class="keywordflow">case</span> KEY_ecirc:     str_Out[i] = (char) -120;   <span class="keywordflow">break</span>;
<a name="l00551"></a>00551                 <span class="keywordflow">case</span> KEY_iacute:    str_Out[i] = (char) -95;    <span class="keywordflow">break</span>;
<a name="l00552"></a>00552                 <span class="keywordflow">case</span> KEY_igrave:    str_Out[i] = (char) -115;   <span class="keywordflow">break</span>;
<a name="l00553"></a>00553                 <span class="keywordflow">case</span> KEY_iuml:      str_Out[i] = (char) -117;   <span class="keywordflow">break</span>;
<a name="l00554"></a>00554                 <span class="keywordflow">case</span> KEY_icirc:     str_Out[i] = (char) -116;   <span class="keywordflow">break</span>;
<a name="l00555"></a>00555                 <span class="keywordflow">case</span> KEY_oacute:    str_Out[i] = (char) -94;    <span class="keywordflow">break</span>;
<a name="l00556"></a>00556                 <span class="keywordflow">case</span> KEY_ograve:    str_Out[i] = (char) -107;   <span class="keywordflow">break</span>;
<a name="l00557"></a>00557                 <span class="keywordflow">case</span> KEY_ouml:      str_Out[i] = (char) -108;   <span class="keywordflow">break</span>;
<a name="l00558"></a>00558                 <span class="keywordflow">case</span> KEY_ocirc:     str_Out[i] = (char) -109;   <span class="keywordflow">break</span>;
<a name="l00559"></a>00559                 <span class="keywordflow">case</span> KEY_uacute:    str_Out[i] = (char) -93;    <span class="keywordflow">break</span>;
<a name="l00560"></a>00560                 <span class="keywordflow">case</span> KEY_ugrave:    str_Out[i] = (char) -105;   <span class="keywordflow">break</span>;
<a name="l00561"></a>00561                 <span class="keywordflow">case</span> KEY_uuml:      str_Out[i] = (char) -127;   <span class="keywordflow">break</span>;
<a name="l00562"></a>00562                 <span class="keywordflow">case</span> KEY_ucirc:     str_Out[i] = (char) -106;   <span class="keywordflow">break</span>;
<a name="l00563"></a>00563                 <span class="keywordflow">case</span> SQUARE:        str_Out[i] = (char) -3;     <span class="keywordflow">break</span>;
<a name="l00564"></a>00564                 <span class="keywordflow">case</span> EURO:          str_Out[i] = (char) -79;    <span class="keywordflow">break</span>;
<a name="l00565"></a>00565                 <span class="keywordflow">case</span> POUND:         str_Out[i] = (char) -100;   <span class="keywordflow">break</span>;
<a name="l00566"></a>00566                 <span class="keywordflow">case</span> MICRO:         str_Out[i] = (char) -26;    <span class="keywordflow">break</span>;
<a name="l00567"></a>00567                 <span class="keywordflow">case</span> PARAGRAPH:     str_Out[i] = (char) -11;    <span class="keywordflow">break</span>;
<a name="l00568"></a>00568                 <span class="keywordflow">case</span> DEGREE:        str_Out[i] = (char) -8;     <span class="keywordflow">break</span>;
<a name="l00569"></a>00569                 <span class="keywordflow">case</span> COPYRIGHT:     str_Out[i] = (char) -72;    <span class="keywordflow">break</span>;
<a name="l00570"></a>00570                 }
<a name="l00571"></a>00571             }
<a name="l00572"></a>00572 
<a name="l00573"></a>00573             <span class="comment">// Send the buffer.</span>
<a name="l00574"></a>00574             <span class="keyword">const</span> <span class="keywordtype">int</span> i_Len = send(m_iSocket, str_Out, i_StringLen, 0);
<a name="l00575"></a>00575             <span class="keywordflow">if</span> (i_Len != i_StringLen)
<a name="l00576"></a>00576             {
<a name="l00577"></a>00577                 <span class="comment">// Something has failed regarding output</span>
<a name="l00578"></a>00578                 <span class="comment">// Check whether the trace stream is not this output stream.</span>
<a name="l00579"></a>00579                 <span class="comment">// If it is, change to stderr in order to avoid infinite loops.</span>
<a name="l00580"></a>00580                 <span class="keywordflow">if</span> (&amp; <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().GetStream().<a class="code" href="classOutputDevice.html#1f5dca5e858cd8f99bf43a0671faac60" title="Actual device handler.">GetActualDevice</a>() == <span class="keyword">this</span>)
<a name="l00581"></a>00581                 {
<a name="l00582"></a>00582                     <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#111bcade621537d1e5b960a4c1331223" title="Stream positionning.">SetStream</a>(<a class="code" href="classOutputDevice.html#3f1e2af2786d5f17e295ce0718d901cf" title="Standard error device.">GetStdErr</a>());
<a name="l00583"></a>00583                     <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_OUT) &lt;&lt; <span class="stringliteral">"Trace stream changed to stderr"</span> &lt;&lt; endl;
<a name="l00584"></a>00584                 }
<a name="l00585"></a>00585 
<a name="l00586"></a>00586                 <a class="code" href="classOutputDevice.html#c831dff60351f1a3dffd667e175e8f23" title="Last error.">m_cliLastError</a>
<a name="l00587"></a>00587                     .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3f12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">"Telnet emission error"</span>)
<a name="l00588"></a>00588                     .<a class="code" href="classResourceString.html#7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#88d585d899c8482aeb434571923739b3142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">"Echec d'émission en telnet"</span>);
<a name="l00589"></a>00589 
<a name="l00590"></a>00590                 <span class="keywordflow">if</span> (i_Len &lt; 0)
<a name="l00591"></a>00591                 {
<a name="l00592"></a>00592                     <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_OUT) &lt;&lt; <span class="stringliteral">"send failed"</span> &lt;&lt; endl;
<a name="l00593"></a>00593                 }
<a name="l00594"></a>00594                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i_Len &lt; i_StringLen)
<a name="l00595"></a>00595                 {
<a name="l00596"></a>00596                     <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_OUT)
<a name="l00597"></a>00597                         &lt;&lt; <span class="stringliteral">"send incomplete"</span>
<a name="l00598"></a>00598                         &lt;&lt; <span class="stringliteral">" (only "</span> &lt;&lt; i_Len &lt;&lt; <span class="stringliteral">" characters sent"</span>
<a name="l00599"></a>00599                         &lt;&lt; <span class="stringliteral">" over "</span> &lt;&lt; i_StringLen &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
<a name="l00600"></a>00600                 }
<a name="l00601"></a>00601                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i_Len &gt; i_StringLen)
<a name="l00602"></a>00602                 {
<a name="l00603"></a>00603                     <a class="code" href="traces_8h.html#757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_OUT)
<a name="l00604"></a>00604                         &lt;&lt; <span class="stringliteral">"strange send return value"</span>
<a name="l00605"></a>00605                         &lt;&lt; <span class="stringliteral">" ("</span> &lt;&lt; i_Len &lt;&lt; <span class="stringliteral">" for "</span> &lt;&lt; i_StringLen &lt;&lt; <span class="stringliteral">" characters sent)"</span> &lt;&lt; endl;
<a name="l00606"></a>00606                 }
<a name="l00607"></a>00607             }
<a name="l00608"></a>00608 
<a name="l00609"></a>00609             <span class="comment">// Free the local output buffer.</span>
<a name="l00610"></a>00610             <span class="keyword">delete</span> [] str_Out;
<a name="l00611"></a>00611         }
<a name="l00612"></a>00612     }
<a name="l00613"></a>00613 }
<a name="l00614"></a>00614 
<a name="l00615"></a>00615 <span class="keywordtype">void</span> <a class="code" href="classTelnetConnection.html#7fa4b5dbc540af6113fb297bee75e6d1" title="Beep handler.">TelnetConnection::Beep</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00616"></a>00616 <span class="keyword"></span>{
<a name="l00617"></a>00617 }
<a name="l00618"></a>00618 
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Jun 15 06:13:23 2009 for CLI by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
